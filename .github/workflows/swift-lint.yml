name: Swift Lint

on:
  pull_request:
    paths:
      - 'clementime-mac/**/*.swift'
      - '.github/workflows/swift-lint.yml'
      - 'clementime-mac/.swiftlint.yml'
  push:
    branches: [ main ]
    paths:
      - 'clementime-mac/**/*.swift'
      - '.github/workflows/swift-lint.yml'
      - 'clementime-mac/.swiftlint.yml'

permissions:
  contents: read
  pull-requests: write

jobs:
  swiftlint:
    runs-on: macos-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Install SwiftLint
        run: brew install swiftlint

      - name: SwiftLint version
        run: swiftlint version

      - name: Run SwiftLint
        working-directory: clementime-mac
        run: |
          swiftlint lint --reporter github-actions-logging || true
          echo "::notice::SwiftLint found issues. This is informational only."

      - name: SwiftLint (auto-correct on PR)
        if: github.event_name == 'pull_request'
        working-directory: clementime-mac
        run: |
          swiftlint --fix --format
          if [[ -n $(git status --porcelain) ]]; then
            echo "::warning::SwiftLint found fixable issues. Run 'swiftlint --fix' locally."
          fi
